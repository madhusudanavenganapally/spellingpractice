<div class="app-container">
  <h1 class="title">🎓 Spelling Practice</h1>

  <!-- Step 1: Enter words -->
  <div *ngIf="!wordsSet" class="card">
    <p class="subtitle">Enter words separated by commas:</p>
    <input
      [(ngModel)]="wordsInput"
      placeholder="e.g. cat, dog, apple"
      class="input"
    />

    <div class="row">
      <button class="btn btn-primary" (click)="addWords()">▶️ Start Practice</button>

      <button
        class="btn btn-secondary"
        (click)="enableMic()"
        *ngIf="!microphoneEnabled"
      >
        🎤 Enable Microphone
      </button>

      <span *ngIf="microphoneEnabled" class="hint">Microphone enabled ✅</span>
    </div>

    <p class="note">Tip: Start Practice will speak the first word and the mic will auto-open.</p>
  </div>

  <!-- Step 2: Practice -->
  <div *ngIf="wordsSet && !showCongrats" class="card">
    <div class="progress-container">
      <div class="progress-bar" [style.width.%]="(currentWordIndex / words.length) * 100"></div>
    </div>

    <h2 class="subtitle">Word {{ currentWordIndex + 1 }} of {{ words.length }}</h2>
    <p class="instruction">Listen carefully and spell the word aloud.</p>

    <div *ngIf="listening" class="status listening">🎙 Listening...</div>
       <!-- Typing input -->
    <div class="typing-row">
      <input [(ngModel)]="typedSpelling" placeholder="Type spelling here" class="input" />
      <button class="btn btn-primary" (click)="checkTyped()">Submit</button>
    </div>

    <div *ngIf="spokenSpelling" class="result">
      <p><strong>You said:</strong> "{{ spokenSpelling }}"</p>

      <div *ngIf="isCorrect === true" class="feedback correct">✅ Correct!</div>

      <div *ngIf="isCorrect === false" class="feedback incorrect">
        ❌ Incorrect. Try again!

        <div class="repeat-row">
          <button
            class="btn btn-accent"
            (click)="repeatWord()"
            [disabled]="listening || recognitionStarting"
            title="Repeat the current word and restart microphone"
          >
            🔁 Repeat Word
          </button>

          <button
            class="btn btn-secondary"
            (click)="enableMic()"
            *ngIf="!microphoneEnabled"
            title="Enable microphone (browser permission)"
          >
            🟢 Enable Microphone
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 3: Congrats -->
  <div *ngIf="showCongrats" class="card congrats">
    <h2 class="subtitle">🎉 Congratulations!</h2>
    <p>You finished all the words!</p>
    <button class="btn btn-primary mt-4" (click)="playAgain()">🔄 Play Again</button>
  </div>
</div>
